---
layout:     post
title:      "GeoMAN论文阅读笔记"
subtitle:   "多层注意力网络的时间序列预测"
date:       2020-05-08
author:     "wumingyao"
header-img: "img/in-post/2020.05/08/bg.jpg"
tags: [GeoMAN,Attention,Time Series,Prediction]
categories: [论文笔记]
---

## 主要内容
* [Abstract](#p1)
* [Introduction](#p2)
* [Preliminary](#p3)
* [Multi-level Attention Net](#p4)
* [Experiments](#p5)
* [Ablation Studies](#p6)
* [ Conclusion](#p7)

## 参考论文：
[《GeoMAN: Multi-level Attention Networks for Geo-sensory Time Series Prediction》](https://www.ijcai.org/Proceedings/2018/0476.pdf)

## 正文

###  <span id="p1">Abstract</span>
在这篇文章中，作者使用基于多层次注意的递归神经网络来预测地理传感器在未来几个小时内的读数，该网络考虑了多个传感器的读数、气象数据和空间数据。

本模型由两个主要部分组成：
* 1）一个多层次的注意机制来建模动态时空依赖。
* 2）一个通用的融合模块，融合来自不同领域的外部因素。

在空气质量数据和水质数据两种真实数据集上的实验表明，该方法优于九种基线方法。

###  <span id="p2">一、Introduction</span>
有大量的传感器，如气象站，已经部署在物理世界。它们每个都有一个独特的地理空间位置，不断生成时间序列读数。一组传感器通过它们的读数之间的空间相关性，共同监测一个空间区域的环境。这些传感器称为地理传感器。此外，一个传感器同时监测不同的目标条件时，通常会产生多种地理传感时间序列。例如，如图1（a）所示，道路中的环路检测器报告关于经过车辆及其行驶速度的及时读数。图1（b）显示传感器每5分钟产生三种不同的水质化学指标。除了监测，对地理感官时间序列预测（如交通预测）的需求也在增加。

![Figure 1](../../../../../../img/in-post/2020.05/08/Figure 1.jpg)
Figure 1: (a)-(b) Examples of geo-sensory time series. (c) The future readings of a sensor depends on its past readings and that of nearby sensors, where the weights are changing over the location and time.

然而，预测地理传感时间序列是非常具有挑战的，主要的影响来自以下两个复杂的因素：

1）动态的时空相关性
* 复杂的传感器间相关性。图1（c）显示了不同传感器时间序列之间的空间相关性是高度动态的，随时间而变化。而且，地感时间序列随地点的变化是非线性的。在建立动态成对相关模型时，经典方法（如概率图形模型[Koller和Friedman，2009]）由于其参数庞大，计算量非常大。
* 动态传感器内相关性。首先，地理感官时间序列通常遵循周期模式（如图1（c）中的S1），该模式随时间而变化，并在地理上发生变化。其次，传感器的读数有时会剧烈波动，并突然发生变化，从而迅速降低先前数值的影响。因此，如何选择相关的先前时间间隔进行预测仍然是一个挑战。

2） 外部因素。传感器的读数也受到周围环境的影响，如气象（如强风）、时间（如高峰时间）和土地利用。

为了应对上述挑战，作者提出了一个多层次注意力网络（GeoMAN）来预测地理传感器在未来几个小时内的读数。本文的研究贡献有三个方面：
* 多层次注意机制。作者提出了一个多层次注意机制来模拟动态时空关联。具体来说，在第一个层次，作者提出了一种新的注意机制，包括局部空间注意和全局空间注意，以捕捉不同传感器时间序列之间的复杂空间相关性（即传感器间相关性）。在第二个层次中，应用时间注意来建模时间序列中不同时间间隔之间的动态时间相关性（即，传感器内相关性）。
* 外部因素融合模块。作者设计了一个通用的融合模块来融合来自不同领域的外部因素。学习到的潜在表征被输入到多层次注意网络中，以增强这些外部因素的重要性。
* 作者在两个数据集上进行评估，相对现有的基线都有优势。

###  <span id="p3">二、Preliminary</span>
#### 2.1 Notations
假设有$N_g$个传感器，每个传感器产生$N_l$种时间序列。在这些序列中，指定一种时间序列做为预测的目标序列，其他类型的序列做为特征。在给定长度为$T$的时间窗口的情况下，使用$Y=(y^1,y^2,\cdots,y^{N_g})\in \mathbb{R}^{N_g \times T}$来表示过去$T$小时内所有目标序列的读数（一个有$N_g$个传感器），其中$y^i\in\mathbb{R}^T$属于传感器$i$。使用$X^i=(x^{i,1},x^{i,2},\cdots,x^{i,N_l})^T=(x_{1}^{i},x_{2}^{i},\cdots,x_{T}^{i})\in\mathbb{R}^{N_l\times T}$做为传感器$i$的局部特征。其中，$x6{i,k}\in\mathbb{R}^T$是第$k$个被传感器记录的时间序列，$x_{t}^{i}=(x_{t}^{i,1},x_{t}^{i,2},\cdots,x_{t}^{i,N_l})^T\in\mathbb{R}^{N_l}$代表$t$时刻传感器$i$所有时间序列的读数。除了$i$传感器的局部特征以外，由于不同传感器之间的地理空间相关性，其他传感器也共享大量对我们的预测有用的信息。最后，结合每个传感器的局部信息到一个集合$\chi^i=\lbrace X^1,X^2,\cdots,X^{N_g} \rbrace$做为传感器$i$的全局特征。

#### 2.2 Problem Statem
给定每个传感器之前的读数和外部因素，预测传感器$i$未来$\tau$小时的读数，标记为$\hat{\bf{y}}^i=(\hat{y}^i_{T+1},\hat{y}^i_{T+2},\cdots,\hat{y}^i_{T+\tau})\in\mathbb{R}^\tau$。

###  <span id="p4">三、Multi-level Attention Net</span>

图2展示了该模型的结构图。本模型遵循编码器-解码器架构，作者使用两个独立的LSTM网络，一个用来编码输入的序列，例如，历史的地理传感器时间序列，另一个用来预测序列$\hat{\bf{y}}^i$的输出序列。具体来说，GeoMAN模型是由以下两个组要部分组成的：

1） 多层注意力机制。它包含一个编码器，该编码器有两种空间注意力机制，以及一个时间注意力解码器。在编码器中，作者开发了两种不同的注意力机制，例如，局部空间注意力和全局空间注意力,它能够捕获复杂的传感器间相关性。在解码器中，作者使用时间注意自适应地选择相关的先前时间间隔进行预测。

2） 外部因素融合。此模块用于处理外部因素的影响，其输出作为其输入的一部分喂给解码器。在这里面，作者使用$h_t\in\mathbb{R}^m$和$s_t\in\mathbb{R}^m$来表示在时间$t$编码器的hiden state和cell state。
![Figure 2](../../../../../../img/in-post/2020.05/08/Figure 2.jpg)
Figure 2: The framework of our approach.

#### 3.1 Spatial Attention

<strong>Local Spatial Attention</strong>

作者首次引入局部空间注意力机制。针对一个特定的传感器，其局部时间序列之间存在复杂的相关性。例如，空气质量监测站记录不同的时间序列例如PM2.5,NO和SO2。实际上，PM2.5的浓度通常受到其他时间序列的影响，包括其他的空气污染物和当地的天气条件。为了处理这个问题，在给定第$i$个传感器的第$k$个局部特征向量的情况下，作者使用一个注意力机制来自适应地捕捉每一个局部特征和目标序列之间地动态相关性：

$$e_t^k= \bf{v}_l^T thanh(\bf{W}_l[\bf{h}_{t-1};\bf{s}_{t-1}]+\bf{U}_l\bf{X}^{i,k}+\bf{b}_l) \tag{1}$$

$$\alpha_t^k=\frac{exp(e_t^k)}{\sum_{j=1}^{N_l}exp(e_t^j)}\tag{2}$$

其中$[\cdot;\cdot]$是连接操作。在这里面，可学习地参数是$\bf{V}_l$，$\bf{b}_l\in mathbb{R}^T$，$\bf{W}_l\in\mathbb{R}^{T\times2m}$和$\bf{U}_l\in\mathbb{R}^{T\times T}$。局部特征的注意权重由输入的局部特征和编码器中的历史状态共同决定，这个权重代表了每个局部特征的重要性。一旦获得注意力权重，在时间步$t$的局部空间注意力的输出向量可以表示为：

$$\tilde{\bf{x}}_t^{local}=(\alpha_t^1x_t^{i,1},\alpha_t^2x_t^{i,2},\cdots,\alpha_t^{N_l}x_t^{i,N_l})^T\tag{3}$$


<strong>Global Spatial Attention</strong>

对于传感器报告的目标序列，其他传感器的目标序列对其有直接影响。然而，影响的比重是高度动态的、随时间改变的。由于可能存在许多不相关的序列，直接利用各种时间序列作为编码器的输入来获取不同传感器之间的相关性，会导致计算量大，性能下降。注意这些权重是受其他传感器局部条件影响的。例如，当风从偏远地区刮来时，这些地区的空气质量受到的影响比过去更大。受此启发，作者开发了一种新的注意机制来捕捉不同传感器之间的动态相关性。假设第$i$个传感器作为我们的预测目标，而另一个传感器$l$，计算它们之间的注意权重（即，影响权重）如下：

$$ g_t^l=V_g^T{thanh}(W_g{[h_{t-1};s_{t-1}]}+U_gy^l+W_g^{'}X^lu_g+b_g \tag{4}$$

该注意机制通过参考目标序列和其他传感器的局部特征，自适应地选择相应的传感器进行预测。同时，通过考虑编码器中先前的隐藏状态$h_{t-1}$和单元状态$s_{t-1}$，历史信息正在跨时间步传播。

空间因素也有助于不同传感器之间的相关性。通常，地理传感器通过一个明确的或底层的网络相互连接。在这里面，作者使用一个矩阵$P\in\mathbb{N_g\times N_g}$来测量地理相似性（例如地理空间距离的倒数），其中$P_{i,j}$表示传感器$i$和$j$之间的相似性。和注意力权重不同的是，地理相似度能够被做为一个先验知识来考虑。在这之后，我们使用一个softmax函数来确保所有的注意权重总和为一，同时考虑到地理空间的相似性，如下所示：

$$\beta_t^l=\frac{exp((1-\lambda)g_t^l+\lambda P_{i,l})}{\sum^{N_g}_{j=1}exp((1-lambda)g^j_t+\lambda P_{i,j}}\tag{5}$$

其中，$\lambda$是一个可调整的超参数。在这些注意力权重算出来后，全局空间注意力的输出向量可表示为：

$$\tilde{x_t}^{global}=(\beta_t^1y_t^1,\beta_t^2y_t^2,\cdots,\beta_t^{N_g}y_t^{N_g})\tag{6}$$

#### 3.2 Temporal Attenti

由于编码器-解码器结构的性能会随着编码器长度的增加而迅速下降，一个重要的扩展是增加了一个时间注意机制，它可以自适应地选择编码器的相关隐藏状态来产生输出序列，即建立目标序列中不同时间间隔之间的动态时间相关性模型。具体地说，为了计算编码器每个隐藏状态上每个输出时间$t^{'}$的注意向量，我们定义:

$$u^o_{t^{'}}=v_d^T thanh(W_d^{'}[d_{t^{'}-1};s^{'}_{t^{'}-1}]+W_dh_o+b_d)\tag{7}$$

$$\gamma^o_{t^{'}}=\frac{exp(u_{t^{'}})}{\sum^T_{j=1}exp(u^j_{t^{'}})}\tag{8}$$

$$c_{t^{'}}=\sum^T_{o-1}\gamma^o_{t^{'}}h_o\tag{9}$$

#### 3.3 External Factor Fusion

地感时间序列与空间因素有很强的相关性,例如POIs和传感器网络。在形式上，这些因素共同体现了一个地区的功能。此外，影响传感器读数的时间因素很多，如气象和时间。如图2所示，我们首先合并时间因素，包括时间特征、气象特征和指定目标传感器的传感器ID。由于未来时段的天气情况未知，我们使用天气预报来提高我们的表现。这些因素大多是分类的，不能直接输入到神经网络中，我们通过将每个分类属性分别输入到不同的嵌入层，将它们转化为一个低维向量。在空间因子方面，我们使用不同类别的poi密度作为poi特征。由于传感器网络的特性取决于具体的情况，因此我们只需利用网络的结构特征，如邻域数目和交叉点数目。最后，我们将得到的嵌入向量与空间特征连接起来作为该模块的输出。

###  <span id="p5">四、Experiments</span>

#### 4.1 Settings
<strong>Datasets</strong>

作者在两个不同的数据集上进行实验,如表1所示。每个数据集包含三个子数据集：气象数据、poi数据和传感器网络数据。

![Table 1](../../../../../../img/in-post/2020.05/08/Table 1.jpg)
<center>Table 1: Detail of the datasets</center>

* <strong>Water quality:</strong>在中国东南部一个城市的整个配水系统中，传感器每5分钟提供一次实时的水质信息，时间为3年，例如余氯（RC），浊度和PH值。由于RC被广泛用作环境科学中的主要水质指标，因此我们将其浓度作为目标系列。共有14个传感器，集中监测10个不同指标，通过管网互联。我们使用刘等人提出的度量作为该数据集中的相似矩阵。
* <strong>Air quality:</strong>从一个公共网站抓取，这个数据集包括许多不同污染物（如PM2.5、SO2和NO）的浓度，以及北京每小时35个传感器收集的一些气象数据（如温度和风速）。其中，大部分情况下，空气质量的主要污染物是PM2.5，因此我们将其读数作为目标序列。我们简单地使用地理空间距离的倒数来表示两个传感器之间的相似性。

<strong>Evaluation Metrics</strong>

作者使用多个准则来评估我们的模型，包括根均方误差（RMSE）和平均绝对误差（MAE），这两个准则在回归任务中都有广泛的应用。
